<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/iron-collapse/iron-collapse.html">
<link rel="import" href="../shared-styles.html">

<dom-module id="ian-skills">
    <template>
        <style include="shared-styles iron-flex iron-flex-alignment">
            :host {
                display: block;
                color: #F1F3F2;
                min-height: 80vh;
            }

            .skills-box {
                margin: 0px 50px 0px 50px;
                height: 100%;
            }

            .title {
                font-size: 48px;
                letter-spacing: 20px;
                line-height: 0;
                color: #66FCF1;
            }

            .skills-container {
                padding-bottom: 100px;
            }

            .skill-row {
                margin: auto;
            }

            .skill-row:hover {
                cursor: pointer;
            }

            .image {
                padding: 10px 0px;
                width: 100px;
                height: 100px;
                display: inline-block;
                vertical-align: middle;
            }

            .content-container {
                text-align: center;
            }

            .language-text {
                color: #66FCF1;
                font-size: 20px;
                display: inline-block;
            }

            .content {
                font-size: 18px;
                margin: 0px 25px;
                line-height: 30px;
                display: block;
            }

            hr {
                width: 2%;
                display: inline-block;
                vertical-align: middle;
                border: 1px solid #66FCF1;
            }

            /* MOBILE CSS */
            .m-line {
                background-color: #66FCF1;
                width: 100%;
                height: 4px;
                margin-top: 10px;
            }

            .m-skills-container {
                padding-bottom: 0px;
            }

            .m-skills-box {
                margin: 0;
            }
        </style>

        <!-- DESKTOP VERSION -->
        <template is="dom-if" if="{{wide}}">
            <div class="skills-box">
                <div class="title hide" id="title">
                    <template is="dom-repeat" items="{{skills.title.content}}">
                        <p>{{item}}</p>
                    </template>
                    <hr>
                </div>
                <div class="layout horizontal wrap center skills-container" id="skillscontainer">
                    <template is="dom-repeat" items="{{skills.content}}">
                        <div class="skill-row hide" id="{{item.id}}">
                            <img src="{{path}}{{item.image}}" class="image" on-mouseover="_toggle" on-mouseout="_toggle">
                        </div>
                    </template>
                </div>
                <div class="content-container">
                    <iron-collapse id="collapse">
                        <hr>
                        <p id="language" class="language-text"></p>
                        <hr>
                        <p class="content" id="content">></p>
                    </iron-collapse>
                </div>
            </div>
        </template>

        <!-- MOBILE VERSION -->
        <template is="dom-if" if="{{!wide}}">
            <div class="m-skills-box">
                <div class="title hide" id="title">
                    <template is="dom-repeat" items="{{skills.title.content}}">
                        <p>{{item}}</p>
                    </template>
                    <div class="m-line"></div>
                </div>
                <div class="layout horizontal wrap center m-skills-container" id="skillscontainer">
                    <template is="dom-repeat" items="{{skills.content}}">
                        <div class="skill-row hide mobile" id="{{item.id}}">
                            <img src="{{path}}{{item.image}}" class="image" on-click="_toggle">
                        </div>
                    </template>
                </div>
                <div class="content-container">
                    <iron-collapse id="collapse">
                        <hr>
                        <p id="language" class="language-text"></p>
                        <hr>
                        <p class="content" id="content">></p>
                    </iron-collapse>
                </div>
            </div>
        </template>

    </template>

    <script>
        class Skills extends Polymer.Element {
            static get is() { return 'ian-skills'; }
            static get properties() {
                return {
                    path: {
                        type: String,
                        value: "../../images/"
                    }
                }
            }

            _toggle(e) {
                var target = e.path[1].id;  
                var mobile = e.path[1].classList.contains('mobile') ? true : false;

                var collapse = this.shadowRoot.querySelector('#collapse');
                var languageName = this.shadowRoot.querySelector('#language');
                var content = this.shadowRoot.querySelector('#content');

                this.skills.content.forEach(function (skill) {
                    if (skill.id == target) {
                        languageName.innerHTML = skill.language;
                        content.innerHTML = skill.content;
                    }
                });

                if (!mobile) {
                    collapse.toggle();
                }
                else {
                    collapse.show();
                }
            }

            ready() {
                super.ready();
            }

            _resetSkillComponents() {
                var skills = this.skills;
                var self = this;
                var skillsTitle = self.shadowRoot.querySelector('#title');;
                var skillsBox = this.shadowRoot.querySelector('#skillscontainer');

                skillsTitle.classList.remove(skills.title.animation);
                _hide(skillsTitle);

                skills.content.forEach(function (skill) {
                    var skillElement = self.shadowRoot.querySelector('#' + skill.id);
                    skillElement.classList.remove(skill.animation);
                    _hide(skillElement);
                });

                skillsBox.removeAttribute('seen');
            }

            _animateSkills() {
                var self = this;
                var timer = Polymer.Async.timeOut;

                var delay = 10;
                var skills = [];

                // Store skill elements, their animation, and delay time
                this.skills.content.forEach(function (skill) {
                    var skillRow = self.shadowRoot.querySelector('#' + skill.id);
                    skills.push([skillRow, skill.animation, delay]);
                    delay += 120;
                });

                // For each stored skill element, add the animation in the delay time intervals
                skills.forEach(function (skill) {
                    timer.run(function () {
                        skill[0].classList.remove('hide');
                        skill[0].classList.add(skill[1]);
                    }, skill[2]);
                });
            }
        }

        window.customElements.define(Skills.is, Skills);
    </script>
</dom-module>