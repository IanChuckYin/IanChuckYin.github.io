<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="shared-styles.html">
<link rel="import" href="common-elements/common-elements.html">

<dom-module id="ian-home">
  <template>
    <style include="shared-styles">
      :host {
        display: block;
      }

      .home-banner {
        background: url("../images/slider-bg.jpg") no-repeat;
        background-size: 100%;
        border-top: 1px solid #66FCF1;
        border-bottom: 1px solid #66FCF1;
        color: #F1F3F2;
        padding: 45px 100px;
        text-align: right;
        height: 79vh;
      }

      .home-banner .name {
        font-size: 48px;
        letter-spacing: 20px;
        margin-bottom: 0;
        text-shadow: -1px 0 #F1F3F2, 0 1px #F1F3F2, 1px 0 #F1F3F2, 0 -1px #F1F3F2;
      }

      .home-banner .occupation {
        font-size: 20px;
        margin-top: 5px;
        letter-spacing: 5px;
        margin-bottom: 35px;
      }

      .home-banner .education {
        margin: 0px;
        letter-spacing: 2px;
        font-size: 18px;
      }

      .home-content-container,
      .skills-content-container {
        padding: 24px 48px;
      }

      .home-content-container {
        background-color: #272424;
      }

      .skills-content-container {
        background-color: #272424;
      }
    </style>

    <div class="home-banner">
      <p class="name" id="name"></p>
      <p class="occupation" id="occupation"></p>
      <div id="education" class="hide">
        <template is="dom-repeat" items="{{about.education}}">
          <p class="education">
            {{item}}
          </p>
        </template>
      </div>
    </div>
    <div class="home-content-container">
      <ian-page-title text="{{about.pageName.content}}" id="pagetitle" class="hide"></ian-page-title>
      <ian-cards text="{{about.aboutMe}}" id="cards"></ian-cards>
    </div>
    <div class="divider"></div>
    <div class="skills-content-container">
      <ian-skills skills="{{about.skills}}" id="skills"></ian-skills>
    </div>
    <div class="divider"></div>
    <ian-footer footer="{{footer}}"></ian-footer>
  </template>

  <script>
    class Home extends Polymer.Element {
      static get is() { return 'ian-home'; }
      static get properties() {
        return {
          selected: {
            type: Boolean,
            value: false,
            observer: '_pageSelected'
          },
          intro: {
            type: Boolean,
            value: false,
            observer: '_introComplete'
          }
        }
      }

      ready() {
        super.ready();
        Polymer.RenderStatus.afterNextRender(this, () => {
          this._initializeWindowScroll();
        })
      }

      _introComplete(complete) {
        if (complete) {
          //this._pageSelected(true);
        }
      }

      // If HOME is selected
      _pageSelected(selected) {
        if (selected && this.intro) {
          Polymer.RenderStatus.afterNextRender(this, () => {
            window.scrollTo(0, 0);
            this._resetPage();
            this._loadPage();
          });
        }
      }

      // Reset the page to default state
      _resetPage() {
        var nameElement = this.$.name;
        var occupationElement = this.$.occupation;
        var educationElement = this.$.education;
        var pageTitleElement = this.$.pagetitle;

        nameElement.innerHTML = "";
        _removeCSS(nameElement, 'fade-in');

        occupationElement.innerHTML = "";
        _removeCSS(occupationElement, 'fade-in');

        _hide(educationElement);
        _removeCSS(educationElement, 'fade-in-move-up');

        _hide(pageTitleElement);
        _removeCSS(pageTitleElement, this.about.pageName.animation);

        this.$.cards._resetCardComponents();
        this.$.skills._resetSkillComponents();
      }

      // Load initial animations
      _loadPage() {
        var self = this;
        var timer = Polymer.Async.timeOut;
        var about = this.about;

        var nameElement = this.$.name;
        var occupationElement = this.$.occupation;
        var educationElement = this.$.education;

        var splitName = about.myName.split("");
        var splitOccupation = about.occupation.split("");

        _addCSS(nameElement, 'fade-in');
        _addCSS(occupationElement, 'fade-in');
        nameElement.classList.add('fade-in');
        occupationElement.classList.add('fade-in');

        timer.run(function () {
          _show(educationElement);
          _addCSS(educationElement, 'fade-in-move-up');
        }, 800);

        _typeAnimation(splitName, nameElement, 50, self);
        _typeAnimation(splitOccupation, occupationElement, 65, self);
      }

      // Animation for typing

      // Initializes the scroll for the app
      _initializeWindowScroll() {
        var self = this;

        var pageTitleElement = this.$.pagetitle;
        var cardsElement = this.$.cards;
        var skillsElement = this.$.skills;

        // For the about me paragraphs
        var paragraphs = [];
        var images = [];
        this.about.aboutMe.forEach(function (about) {
          var paragraph = cardsElement.shadowRoot.querySelector('#' + about.id);
          paragraphs.push([paragraph, about.animation]);

          var image = cardsElement.shadowRoot.querySelector('#' + about.imageID);
          images.push([image, about.imageAnimation]);
        });

        // For the skills
        var skillsTitle = skillsElement.shadowRoot.querySelector('#title');
        var skillsBox = skillsElement.shadowRoot.querySelector('#skillscontainer');

        $(window).scroll(function () {
          if (self.selected) {
            // Check if ABOUT ME title is in view
            _checkIfInView(pageTitleElement, self.about.pageName.animation, 'hide', true);

            // Check if about me paragraphs are in view
            paragraphs.forEach(function (paragraph) {
              _checkIfInView(paragraph[0], paragraph[1], 'hide', true);
            });

            // Check if about me images are in view
            images.forEach(function (image) {
              _checkIfInView(image[0], image[1], 'hide', true);
            })

            // Check if SKILL SET title is in view
            _checkIfInView(skillsTitle, self.about.skills.title.animation, 'hide', true);

            // Check if the skills container is in view
            var skillsContainerVisible = _checkIfInView(skillsBox, null, null, false);

            // If skills are in view, initialize an animation to each skill
            if (skillsContainerVisible) {
              if (!skillsBox.attributes.seen) {
                skillsBox.setAttribute("seen", true);
                skillsElement._animateSkills();
              }
            }
          }
        });
      }
    }

    window.customElements.define(Home.is, Home);
  </script>

</dom-module>