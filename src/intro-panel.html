<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="shared-styles.html">

<dom-module id="intro-panel">
    <template>
        <style include="shared-styles">
            :host {
                display: block;
            }

            .intro-panel {
                background-color: #040C0E;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                position: absolute;
                text-align: center;
            }

            .intro-panel .box {
                width: 15px;
                height: 25px;
                background-color: #30FF12;
                display: inline-block;
                margin-bottom: -5px;
                margin-left: -10px;
            }

            .intro-panel .text-container {
                font-family: Courier New, Courier, monospace;
                color: #30FF12;
                font-size: 25px;
                margin: 0 auto;
                width: 50%;
                text-align: left;
                margin-top: 200px;
            }

            .intro-panel .type-container p {
                display: inline-block;
            }

            .intro-panel p {
                margin: 0;
            }

            .intro-panel .extra {
                margin-top: 20px;
            }
        </style>

        <div id="intro" class="intro-panel">
            <div class="text-container">
                <div class="type-container">
                    <p>
                        {{intro.introTerminal}}
                        <span id="cd"></span>
                    </p>
                    <div id="cdbox" class="box"></div>
                    <p id="enter"></p>
                    <p id="run"></p>
                    <div id="enterbox" class="box"></div>
                </div>

                <p id="extra" class="extra"></p>
            </div>
        </div>

    </template>

    <script>
        class Intro extends Polymer.Element {
            static get is() { return 'intro-panel'; }
            static get properties() {
                return {
                    intro: {
                        type: Array,
                        observer: '_check'
                    }
                }
            }

            // Once Intro is initialized, begin the typing
            _check(e) {
                var skipIntro = true;

                if (skipIntro) {
                    this.remove();
                    this.dispatchEvent(new CustomEvent('intro-complete', { detail: true }));
                }
                else {
                    this._loadPage();
                }
            }

            ready() {
                super.ready();
            }

            // Initializes the typing animation
            _loadPage() {
                var self = this;
                var intro = this.intro;
                var timer = Polymer.Async.timeOut;

                var splitCD = intro.introTypedCD.split("");
                var splitRun = intro.introTypedRun.split("");

                self.$.enterbox.style.display = "none";

                timer.run(function () {
                    self._typeAnimation(splitCD, self.$.cd, 40, self);
                }, 1000);

                timer.run(function () {
                    self.$.cdbox.remove();
                    self.$.enter.innerHTML = intro.introCD;
                    self.$.enterbox.style.display = "inline-block";
                }, 2000);

                timer.run(function () {
                    self._typeAnimation(splitRun, self.$.run, 40, self);
                }, 2500);

                timer.run(function () {
                    self._typeAnimation(intro.introExtra, self.$.extra, 400, self);
                }, 3500);

                timer.run(function () {
                    self._introComplete();
                }, 5500);
            }

            // Type animation function
            _typeAnimation(word, targetElement, timer, self) {
                if (word.length > 0) {
                    targetElement.innerHTML += word.shift();

                    Polymer.Async.timeOut.run(function () {
                        self._typeAnimation(word, targetElement, timer, self);
                    }, timer);
                }
            }

            // End intro
            _introComplete() {
                this.remove();
                this.dispatchEvent(new CustomEvent('intro-complete', { detail: true }));
            }
        }

        window.customElements.define(Intro.is, Intro);
    </script>
</dom-module>